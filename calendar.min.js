(function(){$(document).ready(function(){var d=$(".jsCalendar");for(var c=0,b=d.length;c<b;c++){var e=new a();e.ready(d.eq(c))}});function a(){var r=this,C,m,B,p,k,n,u,e,y,f={},v,D,j,A,o,E,q=0,z="click",t="noAnimationEnd",x=typeof Modernizr!=="undefined"&&Modernizr.csstransforms3d?"webkit moz o ms khtml ".split(" ").join("AnimationEnd ")+"animationEnd":t,g="startDate",l="endDate",c="multipleDates",b=function(I,H){for(var G=0,F=H.length;G<F;G++){if(I&&H[G]&&I.getTime()===H[G].getTime()){return G}}return -1},d=function(H,I){I&&I.clearTime&&I.clearTime();if(H==c){var F=false;if(I===null){f=[]}else{var G=b(I,f);if(G!==-1){f.splice(G,1)}else{f.push(I);F=true}}C.data(H.toLowerCase(),JSON.stringify(f)).trigger(H+"Changed",{dates:f,changedDate:I}).trigger(H+(F?"Added":"Removed"),{dates:f,changedDate:I})}else{if(H==g){e=I}else{y=I}C.data(H.toLowerCase(),!I?"":I.toString());C.trigger(H+"Changed")}i()},s=function(F){F.preventDefault();var H=$(this);if(H.hasClass("inactive")||(H.text().length==0)){return}var G=new Date(v.getFullYear(),v.getMonth(),parseInt(H.text()));if(o){d(g,!e||(G.getTime()!=e.getTime())?G:null);return}else{if(E){d(c,G);return}}if(!e){if(!y){d(g,G)}else{if(G<y){d(g,G)}else{if(y<G){d(g,y);d(l,G)}else{d(l,null)}}}}else{if(!y){if(e<G){d(l,G)}else{if(G<e){d(l,e);d(g,G)}else{d(g,null)}}}else{if(H.hasClass(g)){d(g,null)}else{if(H.hasClass(l)){d(l,null)}else{d(g,null);d(l,null)}}}}},w=function(){Date.prototype.clone=function(){return new Date(this.getTime())};Date.prototype.isLeapYear=function(){var F=this.getFullYear();return(((F%4===0)&&(F%100!==0))||(F%400===0))};Date.prototype.getDaysInMonth=function(){return[31,(this.isLeapYear(this.getFullYear())?29:28),31,30,31,30,31,31,30,31,30,31][this.getMonth()]};Date.prototype.moveToFirstDayOfMonth=function(){this.setDate(1);return this};Date.prototype.moveToLastDayOfMonth=function(){this.setDate(this.getDaysInMonth());return this};Date.prototype.addMilliseconds=function(F){this.setMilliseconds(this.getMilliseconds()+F);return this};Date.prototype.addDays=function(F){return this.addMilliseconds(F*86400000)};Date.prototype.addMonths=function(F){var G=this.getDate();this.setDate(1);this.setMonth(this.getMonth()+F);this.setDate(Math.min(G,this.getDaysInMonth()));return this};Date.prototype.clearTime=function(){this.setHours(0);this.setMinutes(0);this.setSeconds(0);this.setMilliseconds(0);return this}},h=function(F){return(F+q)%7},i=function(){n.removeClass(g).removeClass(l).removeClass(c).removeClass("betweenDates");var H=v.clone().moveToFirstDayOfMonth();var K=v.clone().moveToLastDayOfMonth();var G=h(H.getDay())-1;if(!!e&&!!y&&(e<K)&&(y>H)){var F=new Date(Math.max(H,e.clone().addDays(1)));var J=new Date(Math.min(K,y.clone().addDays(-1)));if(F<=J){n.slice(G+F.getDate(),G+J.getDate()+1).addClass("betweenDates")}}if(!!e&&(H<=e)&&(e<=K)){n.eq(G+e.getDate()).addClass(g)}if(!!y&&(H<=y)&&(y<=K)){n.eq(G+y.getDate()).addClass(l)}for(var I in f){if(!!f[I]&&(H<=f[I])&&(f[I]<=K)){n.eq(G+f[I].getDate()).addClass(c)}}};r.ready=function(N){C=N;m=$('<a href="#">&lt;</a>');B=$('<a href="#">&gt;</a>');p=$('<li class="calMonth"></li>');C.append($('<ul class="calButtonBar"></ul>').append($('<li class="calPrevious"></li>').append(m)).append(p).append($('<li class="calNext"></li>').append(B)));for(var I=0,G="",H="";I<7;I++){G+="<th></th>";H+='<td><a href="#"></a></td>'}for(var I=0,K="";I<6;I++){K+="<tr>"+H+"</tr>"}C.append('<div class="calGrid"><table><tr>'+G+"</tr>"+K+"</table></div>");k=C.find("th");n=C.find("td a");u=C.find("tr");u.eq(1).addClass("first");o=C.hasClass("jsSingleDate");E=C.hasClass("jsMultipleDates");q=C.data("firstdayofweek")||q;C.get(0).calendar=r;if($.fn){$.fn.slice=$.fn.slice||function(P,O){return $([].slice.call(this,P,O))};$.fn.calendar=function(){return this.get(0).calendar}}w();D=(new Date()).clearTime();j=D;e=C.data("startdate");e=e?new Date(e).clearTime():null;y=C.data("enddate");y=y?new Date(y).clearTime():null;f=C.data("multipledates");if(typeof f=="string"){f=JSON.parse(f)}for(var I in f){f[I]=new Date(f[I]).clearTime()}v=(e||(f?f[0]:false)||D).clone();A=C.data("localized_date");if(typeof A=="string"){A=JSON.parse(A)}var L=C.find(".calGrid");var J=[];var F=function(O){if(L.children().length>1){J.push(O);return true}return false};var M=function(){if(J.length>0){setTimeout(function(){J.shift().trigger(z)},0)}};m.bind(z,function(O){O.preventDefault();if(F(m)){return}v=v.addMonths(-1);var P=$("<table>"+C.find("table").html()+"</table>");L.append(P);n.closest("table").addClass("turndown").bind(x,function(Q){$(this).removeClass("turndown").unbind(x);P.remove();M()}).trigger(t);r.showMonth(v)});B.bind(z,function(O){O.preventDefault();if(F(B)){return}v=v.addMonths(+1);var P=$('<table class="turnup">'+C.find("table").html()+"</table>");L.append(P);P.bind(x,function(Q){P.remove();M()}).trigger(t);r.showMonth(v)});C.bind("resetDates",function(O){d(g,null);d(l,null);E&&d(c,null)});n.bind(z,s);r.showMonth(v)};r.setDates=function(I,G){if(E){I=(I&&I.constructor===Array)?I:[I];for(var H=0,F=I.length;H<F;H++){d(c,I[H])}}else{d(g,I&&G?new Date(Math.min(I,G)):I);!o&&d(l,I&&G?(I.getTime()!=G.getTime()?new Date(Math.max(I,G)):null):G)}};r.showMonth=function(G){j=new Date(Math.max(j,D));if(!!A){p.text(A.months.names["long"][G.getMonth()]+" "+G.getFullYear());for(var J=0,N=k.length;J<N;J++){k.eq(h(J)).text(A.days.names.min[J])}}var O=j>G.clone().moveToLastDayOfMonth();var K=!O&&(j>=G.clone().moveToFirstDayOfMonth());var I=j.getDate();n.addClass("noTransition").removeClass("inactive");u.removeClass("last").removeClass("hidden");for(var F=h(G.clone().moveToFirstDayOfMonth().getDay())-1,M=F+G.clone().moveToLastDayOfMonth().getDate(),J=0,N=n.length;J<N;J++){var L=(J>F)&&(J<=M);var H=n.eq(J).text(L?(""+(J-F)):"");H.toggleClass("noDate",(!L));H.toggleClass("inactive",(L&&(O||(K&&(J-F<I)))));H.toggleClass("today",(K&&D.getDate()==(J-F)));if(J==M){H.closest("tr").addClass("last").next().addClass("hidden").next().addClass("hidden")}}setTimeout(function(){n.removeClass("noTransition")},0);i()}}})();