(function(){$(document).ready(function(){var d=$(".jsCalendar");for(var c=0,b=d.length;c<b;c++){var e=new a();e.ready(d.eq(c))}});function a(){var r=this,D,m,C,p,k,n,u,e,z,f={},v,E,j,B,o,F,w,q=0,A="click",t="noAnimationEnd",y=typeof Modernizr!=="undefined"&&Modernizr.csstransforms3d?"webkit moz o ms khtml ".split(" ").join("AnimationEnd ")+"animationEnd":t,g="startDate",l="endDate",c="multipleDates",b=function(J,I){for(var H=0,G=I.length;H<G;H++){if(J&&I[H]&&J.getTime()===I[H].getTime()){return H}}return -1},d=function(I,J){J&&J.clearTime&&J.clearTime();if(I==c){var G=false;if(J===null){f=[]}else{var H=b(J,f);if(H!==-1){f.splice(H,1)}else{if(w!==null&&f.length>=~~w){return false}else{f.push(J);G=true}}}D.data(I.toLowerCase(),JSON.stringify(f)).trigger(I+"Changed",{dates:f,changedDate:J}).trigger(I+(G?"Added":"Removed"),{dates:f,changedDate:J})}else{if(I==g){e=J}else{z=J}D.data(I.toLowerCase(),!J?"":J.toString());D.trigger(I+"Changed")}i()},s=function(G){G.preventDefault();var I=$(this);if(I.hasClass("inactive")||(I.text().length==0)){return}var H=new Date(v.getFullYear(),v.getMonth(),parseInt(I.text()));if(o){d(g,!e||(H.getTime()!=e.getTime())?H:null);return}else{if(F){d(c,H);return}}if(!e){if(!z){d(g,H)}else{if(H<z){d(g,H)}else{if(z<H){d(g,z);d(l,H)}else{d(l,null)}}}}else{if(!z){if(e<H){d(l,H)}else{if(H<e){d(l,e);d(g,H)}else{d(g,null)}}}else{if(I.hasClass(g)){d(g,null)}else{if(I.hasClass(l)){d(l,null)}else{d(g,null);d(l,null)}}}}},x=function(){Date.prototype.clone=function(){return new Date(this.getTime())};Date.prototype.isLeapYear=function(){var G=this.getFullYear();return(((G%4===0)&&(G%100!==0))||(G%400===0))};Date.prototype.getDaysInMonth=function(){return[31,(this.isLeapYear(this.getFullYear())?29:28),31,30,31,30,31,31,30,31,30,31][this.getMonth()]};Date.prototype.moveToFirstDayOfMonth=function(){this.setDate(1);return this};Date.prototype.moveToLastDayOfMonth=function(){this.setDate(this.getDaysInMonth());return this};Date.prototype.addMilliseconds=function(G){this.setMilliseconds(this.getMilliseconds()+G);return this};Date.prototype.addDays=function(G){return this.addMilliseconds(G*86400000)};Date.prototype.addMonths=function(G){var H=this.getDate();this.setDate(1);this.setMonth(this.getMonth()+G);this.setDate(Math.min(H,this.getDaysInMonth()));return this};Date.prototype.clearTime=function(){this.setHours(0);this.setMinutes(0);this.setSeconds(0);this.setMilliseconds(0);return this}},h=function(G){return(G+q)%7},i=function(){n.removeClass(g).removeClass(l).removeClass(c).removeClass("betweenDates");var I=v.clone().moveToFirstDayOfMonth();var L=v.clone().moveToLastDayOfMonth();var H=h(I.getDay())-1;if(!!e&&!!z&&(e<L)&&(z>I)){var G=new Date(Math.max(I,e.clone().addDays(1)));var K=new Date(Math.min(L,z.clone().addDays(-1)));if(G<=K){n.slice(H+G.getDate(),H+K.getDate()+1).addClass("betweenDates")}}if(!!e&&(I<=e)&&(e<=L)){n.eq(H+e.getDate()).addClass(g)}if(!!z&&(I<=z)&&(z<=L)){n.eq(H+z.getDate()).addClass(l)}for(var J in f){if(!!f[J]&&(I<=f[J])&&(f[J]<=L)){n.eq(H+f[J].getDate()).addClass(c)}}};r.ready=function(O){D=O;m=$('<a href="#">&lt;</a>');C=$('<a href="#">&gt;</a>');p=$('<li class="calMonth"></li>');D.append($('<ul class="calButtonBar"></ul>').append($('<li class="calPrevious"></li>').append(m)).append(p).append($('<li class="calNext"></li>').append(C)));for(var J=0,H="",I="";J<7;J++){H+="<th></th>";I+='<td><a href="#"></a></td>'}for(var J=0,L="";J<6;J++){L+="<tr>"+I+"</tr>"}D.append('<div class="calGrid"><table><tr>'+H+"</tr>"+L+"</table></div>");k=D.find("th");n=D.find("td a");u=D.find("tr");u.eq(1).addClass("first");o=D.hasClass("jsSingleDate");F=D.hasClass("jsMultipleDates");w=D.data("multipledates-max")||null;q=D.data("firstdayofweek")||q;D.get(0).calendar=r;if($.fn){$.fn.slice=$.fn.slice||function(Q,P){return $([].slice.call(this,Q,P))};$.fn.calendar=function(){return this.get(0).calendar}}x();E=(new Date()).clearTime();j=D.data("mindate")?new Date(D.data("mindate")).clearTime():E;e=D.data("startdate");e=e?new Date(e).clearTime():null;z=D.data("enddate");z=z?new Date(z).clearTime():null;f=D.data("multipledates");if(typeof f=="string"){f=JSON.parse(f)}for(var J in f){f[J]=new Date(f[J]).clearTime()}v=(e||(f?f[0]:false)||E).clone();B=D.data("localized_date");if(typeof B=="string"){B=JSON.parse(B)}var M=D.find(".calGrid");var K=[];var G=function(P){if(M.children().length>1){K.push(P);return true}return false};var N=function(){if(K.length>0){setTimeout(function(){K.shift().trigger(A)},0)}};m.bind(A,function(P){P.preventDefault();if(G(m)){return}v=v.addMonths(-1);var Q=$("<table>"+D.find("table").html()+"</table>");M.append(Q);n.closest("table").addClass("turndown").bind(y,function(R){$(this).removeClass("turndown").unbind(y);Q.remove();N()}).trigger(t);r.showMonth(v)});C.bind(A,function(P){P.preventDefault();if(G(C)){return}v=v.addMonths(+1);var Q=$('<table class="turnup">'+D.find("table").html()+"</table>");M.append(Q);Q.bind(y,function(R){Q.remove();N()}).trigger(t);r.showMonth(v)});D.bind("resetDates",function(P){d(g,null);d(l,null);F&&d(c,null)});n.bind(A,s);r.showMonth(v)};r.setDates=function(J,H){if(F){J=(J&&J.constructor===Array)?J:[J];for(var I=0,G=J.length;I<G;I++){d(c,J[I])}}else{d(g,J&&H?new Date(Math.min(J,H)):J);!o&&d(l,J&&H?(J.getTime()!=H.getTime()?new Date(Math.max(J,H)):null):H)}};r.showMonth=function(H){if(!!B){p.text(B.months.names["long"][H.getMonth()]+" "+H.getFullYear());for(var K=0,O=k.length;K<O;K++){k.eq(h(K)).text(B.days.names.min[K])}}var P=j>H.clone().moveToLastDayOfMonth();var L=!P&&(j>=H.clone().moveToFirstDayOfMonth());var J=j.getDate();n.addClass("noTransition").removeClass("inactive");u.removeClass("last").removeClass("hidden");for(var G=h(H.clone().moveToFirstDayOfMonth().getDay())-1,N=G+H.clone().moveToLastDayOfMonth().getDate(),K=0,O=n.length;K<O;K++){var M=(K>G)&&(K<=N);var I=n.eq(K).text(M?(""+(K-G)):"");I.toggleClass("noDate",(!M));I.toggleClass("inactive",(M&&(P||(L&&(K-G<J)))));I.toggleClass("today",(L&&E.getDate()==(K-G)));if(K==N){I.closest("tr").addClass("last").next().addClass("hidden").next().addClass("hidden")}}setTimeout(function(){n.removeClass("noTransition")},0);i()}}})();