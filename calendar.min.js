(function(e){function n(){var e=this,t,n,r,i,s,o,u,a,f,l={},c,h,p,d,v,m,g,y,b=0,w="click",E="noAnimationEnd",S=typeof Modernizr!="undefined"&&Modernizr.csstransforms3d?"webkitAnimationEnd oanimationend MSAnimationEnd animationend":E,x="startDate",T="endDate",N="multipleDates",C=function(e,t){for(var n=0,r=t.length;n<r;n++)if(e&&t[n]&&e.getTime()===t[n].getTime())return n;return-1},k=function(e,n){n&&n.clearTime&&n.clearTime();if(e==N){var r=!1;if(n===null)l=[];else{var i=C(n,l);if(i!==-1)l.splice(i,1);else{if(y!==null&&l.length>=~~y)return!1;l.push(n),r=!0}}t.data(e.toLowerCase(),JSON.stringify(l)).trigger(e+"Changed",{dates:l,changedDate:n}).trigger(e+(r?"Added":"Removed"),{dates:l,changedDate:n})}else e==x?a=n:f=n,t.data(e.toLowerCase(),n?n.toString():""),t.trigger(e+"Changed");M()},L=function(e){e.preventDefault();var t=$(this);if(t.hasClass("inactive")||t.text().length==0)return;var n=new Date(c.getFullYear(),c.getMonth(),parseInt(t.text()));if(m){k(x,!a||n.getTime()!=a.getTime()?n:null);return}if(g){k(N,n);return}a?f?t.hasClass(x)?k(x,null):t.hasClass(T)?k(T,null):(k(x,null),k(T,null)):a<n?k(T,n):n<a?(k(T,a),k(x,n)):k(x,null):f?n<f?k(x,n):f<n?(k(x,f),k(T,n)):k(T,null):k(x,n)},A=function(){Date.prototype.clone=function(){return new Date(this.getTime())},Date.prototype.isLeapYear=function(){var e=this.getFullYear();return e%4===0&&e%100!==0||e%400===0},Date.prototype.getDaysInMonth=function(){return[31,this.isLeapYear(this.getFullYear())?29:28,31,30,31,30,31,31,30,31,30,31][this.getMonth()]},Date.prototype.moveToFirstDayOfMonth=function(){return this.setDate(1),this},Date.prototype.moveToLastDayOfMonth=function(){return this.setDate(this.getDaysInMonth()),this},Date.prototype.addMilliseconds=function(e){return this.setMilliseconds(this.getMilliseconds()+e),this},Date.prototype.addDays=function(e){return this.addMilliseconds(e*864e5)},Date.prototype.addMonths=function(e){var t=this.getDate();return this.setDate(1),this.setMonth(this.getMonth()+e),this.setDate(Math.min(t,this.getDaysInMonth())),this},Date.prototype.clearTime=function(){return this.setHours(0),this.setMinutes(0),this.setSeconds(0),this.setMilliseconds(0),this}},O=function(e){return(e+b)%7},M=function(){o.removeClass(x).removeClass(T).removeClass(N).removeClass("betweenDates");var e=c.clone().moveToFirstDayOfMonth(),t=c.clone().moveToLastDayOfMonth(),n=O(e.getDay())-1;if(!!a&&!!f&&a<t&&f>e){var r=new Date(Math.max(e,a.clone().addDays(1))),i=new Date(Math.min(t,f.clone().addDays(-1)));r<=i&&o.slice(n+r.getDate(),n+i.getDate()+1).addClass("betweenDates")}!!a&&e<=a&&a<=t&&o.eq(n+a.getDate()).addClass(x),!!f&&e<=f&&f<=t&&o.eq(n+f.getDate()).addClass(T);for(var s in l)!!l[s]&&e<=l[s]&&l[s]<=t&&o.eq(n+l[s].getDate()).addClass(N)};e.ready=function(C){t=C,n=$('<a href="#">&lt;</a>'),r=$('<a href="#">&gt;</a>'),i=$('<li class="calMonth"></li>'),t.append($('<ul class="calButtonBar"></ul>').append($('<li class="calPrevious"></li>').append(n)).append(i).append($('<li class="calNext"></li>').append(r)));for(var O=0,M="",_="";O<7;O++)M+="<th></th>",_+='<td><a href="#"></a></td>';for(var O=0,D="";O<6;O++)D+="<tr>"+_+"</tr>";t.append('<div class="calGrid"><table><tr>'+M+"</tr>"+D+"</table></div>"),s=t.find("th"),o=t.find("td a"),u=t.find("tr"),u.eq(1).addClass("first"),m=t.hasClass("jsSingleDate"),g=t.hasClass("jsMultipleDates"),y=t.data("multipledates-max")||null,b=t.data("firstdayofweek")||b,t.get(0).calendar=e,$.fn&&($.fn.slice=$.fn.slice||function(e,t){return $([].slice.call(this,e,t))},$.fn.calendar=function(){return this.get(0).calendar}),A(),h=(new Date).clearTime(),p=t.data("mindate")?(new Date(t.data("mindate"))).clearTime():h,d=t.data("maxdate")?t.data("maxdate").trim()=="today"?h:(new Date(t.data("maxdate"))).clearTime():!1,a=t.data("startdate"),a=a?(new Date(a)).clearTime():null,f=t.data("enddate"),f=f?(new Date(f)).clearTime():null,l=t.data("multipledates"),typeof l=="string"&&(l=JSON.parse(l));for(var O in l)l[O]=(new Date(l[O])).clearTime();c=(a||(l?l[0]:!1)||h).clone(),v=t.data("localized_date"),typeof v=="string"&&(v=JSON.parse(v));var P=t.find(".calGrid"),H=[],B=function(e){return P.children().length>1?(H.push(e),!0):!1},j=function(){H.length>0&&setTimeout(function(){H.shift().trigger(w)},0)};n.bind(w,function(r){r.preventDefault();if(B(n))return;c=c.addMonths(-1);var i=$("<table>"+t.find("table").html()+"</table>");P.append(i),o.closest("table").bind(S,function(e){$(this).removeClass("turndown").unbind(S),i.remove(),j()}).addClass("turndown").trigger(E),e.showMonth(c)}),r.bind(w,function(n){n.preventDefault();if(B(r))return;c=c.addMonths(1);var i=$('<table class="turnup">'+t.find("table").html()+"</table>");P.append(i),i.bind(S,function(e){i.remove(),j()}).trigger(E),e.showMonth(c)}),t.bind("resetDates",function(e){k(x,null),k(T,null),g&&k(N,null)}),o.bind(w,L),e.showMonth(c)},e.setDates=function(e,t){if(g){e=e&&e.constructor===Array?e:[e];for(var n=0,r=e.length;n<r;n++)k(N,e[n])}else k(x,e&&t?new Date(Math.min(e,t)):e),!m&&k(T,e&&t?e.getTime()!=t.getTime()?new Date(Math.max(e,t)):null:t)},e.showMonth=function(e){if(!!v){i.text(v.months.names["long"][e.getMonth()]+" "+e.getFullYear());for(var t=0,n=s.length;t<n;t++)s.eq(O(t)).text(v.days.names.min[t])}var r=p>e.clone().moveToLastDayOfMonth(),a=d?d<e.clone().moveToFirstDayOfMonth():!1,f=p.clone().moveToFirstDayOfMonth()-e.clone().moveToFirstDayOfMonth()===0,l=d?d.clone().moveToFirstDayOfMonth()-e.clone().moveToFirstDayOfMonth()===0:!1,c=h.clone().moveToFirstDayOfMonth()-e.clone().moveToFirstDayOfMonth()===0,m=p.getDate(),g=d&&d.getDate();o.addClass("noTransition").removeClass("inactive"),u.removeClass("last").removeClass("hidden");for(var y=O(e.clone().moveToFirstDayOfMonth().getDay())-1,b=y+e.clone().moveToLastDayOfMonth().getDate(),t=0,n=o.length;t<n;t++){var w=t>y&&t<=b,E=o.eq(t).text(w?""+(t-y):"");E.toggleClass("noDate",!w),E.toggleClass("inactive",w&&(r||f&&t-y<m||a||l&&t-y>g)),E.toggleClass("today",c&&h.getDate()==t-y),t==b&&E.closest("tr").addClass("last").next().addClass("hidden").next().addClass("hidden")}setTimeout(function(){o.removeClass("noTransition")},0),M()}}var t=e.document;$(t).ready(function(){var e=$(".jsCalendar");for(var t=0,r=e.length;t<r;t++){var i=new n;i.ready(e.eq(t))}}),e.Calendar=e.Calendar||n})(window);
